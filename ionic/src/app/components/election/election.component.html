<div class="container">
    <div class="header">
        <h1>
            {{election?.name}}
        </h1>
        <p>
            {{election?.description}}
        </p>
        <div class="dates">
            <h3>starts on {{election?.start | date: 'short'}}</h3>
            <h3>ends on {{election?.end | date: 'short'}}</h3>
        </div>
    </div>
    @if ((electionStage | electionstage) === 'tally'){
        <div *ngIf="finalTally() as tally">
            <div class="formsHeader">
                <h2>Results</h2>
                <div class="filters">
                    <h3>Settings</h3>
                    <div>
                        <button [class.selected]="chart.view === 'candidate'" (click)="chart.prepareCandidateChartData()">Candidates</button>
                        <button [class.selected]="chart.view === 'party'" (click)="chart.preparePartyChartData()">Parties</button>
                        <button class="imgbutton" (click)="chart.swapType()">
                           @if (chart.type === 'bar') {
                               <img height="25px" width="20px" src="../../../assets/images/chart-simple-solid.svg">
                            }@else {
                               <img height="25px" width="20px" src="../../../assets/images/chart-pie-solid.svg">
                            }
                        </button>
                    </div>
                </div>
                <hr>
            </div>
            <div class="chart">
                <UI-tally-chart #chart [tally]="tally" [candidates]="election!.candidates"></UI-tally-chart>
            </div>
        </div>
    }@else{
    <div class="formsHeader">
        <h2>Candidates</h2>
        <div class="filters">
            <h3>Settings</h3>
            <div>
                <button (click)="toggleSort()">sort ↑↓</button>
                Party:
                <select (change)="filterParty($event)" id="parties">
                    <option></option>
                    <option *ngFor="let party of election?.parties">{{party.acronym}}</option>
                    </select>
                    <input placeholder="search" (input)="filter($event)">
            </div>
        </div>
        <hr>
    </div>
        <form [formGroup]="form" (ngSubmit)="vote(voteBtn)">
            @if (FilteredCandidates) {
                @for (candidate of FilteredCandidates.sort(sortFn.bind(this)); track $index) {
                    <div class="candidate">
                        <input type="radio" [id]="candidate.name" [disabled]="(electionStage | electionstage) !== 'voting'" formControlName="selectedCandidate" [value]="candidate.index">
                        <label [for]="candidate.name">
                            <h3>
                                {{candidate.index}}. {{candidate.name}} <span>/{{candidate.party}}/</span>
                            </h3>
                        </label>
                        <div>
                            {{candidate.bio}}
                        </div>
                    </div>
                }
            }
            <UI-button #voteBtn [disabled]="!isEligible || !form.valid || (electionStage | electionstage) !== 'voting'" type="submit">vote</UI-button>
        </form>
    }
    <button [routerLink]="['/list']" routerLinkActive="router-link-active">back</button>
    <button (click)="enrollVoters()">Enroll voters</button>
    <button (click)="splitGroups()">split groups</button>
    <button (click)="submitPK()">SubmitPK</button>
    <button (click)="finishSetupPhase()">finishSetupPhase</button>
    <button (click)="precomputeMPCkeys()">PrecomputeMPC keys</button>
    <button (click)="computeMPCkeys()">ComputeMPC keys</button>
    <button (click)="computeBlindedVotesSum()">compute blinded votes sums</button>
    <button (click)="computeGroupTallies()">compute group tallies</button>
    <button (click)="getTallies()">get tallies</button>
    <button (click)="logStats()">log stats</button>
</div>